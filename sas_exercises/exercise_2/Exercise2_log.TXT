NOTE: PROCEDURE PRINTTO used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
      

154  
155  /* create use-defined formats and store them in the work folder */
156  proc format;
157     value subpop
158            1 = 'oneplusnacroticetc'
159        2 = 'others';
NOTE: Format SUBPOP has been output.
160  run;

NOTE: PROCEDURE FORMAT used (Total process time):
      real time           0.01 seconds
      cpu time            0.01 seconds
      

161  
162  /*****************************************************************************
163  keep the specified variables when reading the input data set and
164  restrict to observations having therapeutic classification (tc)
165  codes for narcotic analgesics or narcotic analgesic combos
166  *******************************************************************************/
167  
168  %let datafolder = c:\meps_data;  /* adjust the folder name if needed */
169  libname cdata "&datafolder";
NOTE: Libref CDATA was successfully assigned as follows: 
      Engine:        V9 
      Physical Name: c:\meps_data
170  
171  data work.drug;
172    set cdata.h220a (keep=dupersid rxrecidx linkidx tc1s1_1 rxxp20x rxsf20x
173                     where=(tc1s1_1 in (60, 191)));
174  run;

NOTE: There were 8621 observations read from the data set CDATA.H220A.
      WHERE tc1s1_1 in (60, 191);
NOTE: The data set WORK.DRUG has 8621 observations and 6 variables.
NOTE: DATA statement used (Total process time):
      real time           0.14 seconds
      cpu time            0.01 seconds
      

175  
176  ods html close; /* this will make the default html output no longer active,
177                    and the output will not be displayed in the results viewer.*/
178  title 'sample dump for pmed records with narcotic analgesics or narcotic analgesic combos, 2020';
179  proc print data=work.drug (obs=12) noobs;
180     var dupersid rxrecidx linkidx tc1s1_1 rxxp20x rxsf20x;
181  run;

NOTE: There were 12 observations read from the data set WORK.DRUG.
NOTE: PROCEDURE PRINT used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
      

182  
183  
184  /* sum "rxxp20x and rxsf20x" data to person-level */
185  
186  proc summary data=work.drug nway;
187    class dupersid;
188    var rxxp20x rxsf20x;
189    output out=work.perdrug (drop = _type_ rename=(_freq_ = n_phrchase))
190                    /*# of purchases per person */
191               sum=tot_exp oop_exp;
192  run;

NOTE: There were 8621 observations read from the data set WORK.DRUG.
NOTE: The data set WORK.PERDRUG has 1948 observations and 4 variables.
NOTE: PROCEDURE SUMMARY used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
      

193  
194  title 'sample dump for person-level expenditures for narcotic analgesics or narcotic analgesic combos';
195  proc print data=perdrug (obs=3);
196  sum n_phrchase;
197  run;

NOTE: There were 3 observations read from the data set WORK.PERDRUG.
NOTE: PROCEDURE PRINT used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
      

198  
199  data work.perdrug;
200   set perdrug;
201   /* create a new variable for expenses excluding out-of-pocket expenses */
202   third_payer   = tot_exp- oop_exp;
203   run;

NOTE: There were 1948 observations read from the data set WORK.PERDRUG.
NOTE: The data set WORK.PERDRUG has 1948 observations and 5 variables.
NOTE: DATA statement used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
      

204  proc sort data=work.perdrug; by dupersid; run;

NOTE: There were 1948 observations read from the data set WORK.PERDRUG.
NOTE: The data set WORK.PERDRUG has 1948 observations and 5 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
      

205  
206  /*sort the full-year(fy) consolidated file*/
207  proc sort data=cdata.h224 (keep=dupersid varstr varpsu perwt20f) out=work.h224;
208  by dupersid; run;

NOTE: Input data set is already sorted; it has been copied to the output data set.
NOTE: There were 27805 observations read from the data set CDATA.H224.
NOTE: The data set WORK.H224 has 27805 observations and 4 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.13 seconds
      cpu time            0.12 seconds
      

209  
210  /*merge the person-level expenditures to the fy puf*/
211  data  work.personrxlinked;
212  merge work.h224 (in=person)
213        work.perdrug  (in=rx keep=dupersid n_phrchase tot_exp oop_exp third_payer);
214     by dupersid;
215     if person and rx then subpop = 1; /*persons with 1+ narcotic analgesics or narcotic analgesic combos */
216  
217     else if person ne rx then do;
218           subpop         = 2 ;  /*persons without any purchase of narcotic analgesics or narcotic analgesic combos*/
219           n_phrchase  = 0 ;  /*# of purchases per person */
220           third_payer = 0 ;
221           tot_exp = 0 ;
222           oop_exp = 0 ;
223      end;
224      if person;
225      label   tot_exp= 'total expenses for nacrotic etc'
226              oop_exp = 'out-of-pocket expenses'
227              third_payer = 'total expenses minus out-of-pocket expenses'
228              n_phrchase  = '# of purchases per person';
229  run;

NOTE: There were 27805 observations read from the data set WORK.H224.
NOTE: There were 1948 observations read from the data set WORK.PERDRUG.
NOTE: The data set WORK.PERSONRXLINKED has 27805 observations and 9 variables.
NOTE: DATA statement used (Total process time):
      real time           0.01 seconds
      cpu time            0.01 seconds
      

230  
231  /* calculate estimates on use and expenditures*/
232  ods graphics off; /*suppress the graphics */
233  ods listing; /* open the listing destination*/
234  ods exclude statistics /* not to generate output for the overall population */
235  title 'person-level estimates on expenditures and use for narcotic analgesics or narcotic combos, 2020';
236  /* when you request sum in proc surveymeans, the procedure computes std by default.*/
237  proc surveymeans data=work.personrxlinked nobs sumwgt mean stderr sum;
238    var  n_phrchase tot_exp oop_exp third_payer ;
239    strata  varstr ;
240    cluster varpsu;
241    weight  perwt20f;
242    domain  subpop("oneplusnacroticetc");
243    format subpop subpop.;
244   run;

NOTE: Due to nonpositive weights, 958 observation(s) were deleted.
NOTE: PROCEDURE SURVEYMEANS used (Total process time):
      real time           0.04 seconds
      cpu time            0.04 seconds
      

245  title; /* cancel the TITLE and TITLE2 statements */
246  
247  /* uncomment the next 2 lines of code to close the proc printto if used earlier */
248  
249  proc printto;
250  run;

