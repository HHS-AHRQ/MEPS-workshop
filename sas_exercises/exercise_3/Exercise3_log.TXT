NOTE: PROCEDURE PRINTTO used (Total process time):
      real time           0.00 seconds
      cpu time            0.00 seconds
      

415  
416  /* create use-defined formats and store them in a catalog called formats in the work folde */
417  
418  %let datafolder = c:\meps_data;  /* adjust the folder name, if needed */
419  libname new "&datafolder";
NOTE: Libref NEW refers to the same physical library as CDATA.
NOTE: Libref NEW was successfully assigned as follows: 
      Engine:        V9 
      Physical Name: c:\meps_data
420  
421  /* create 3 macro variables, assigning a list of variables to each */
422  %let kept_vars_2018 =  dupersid panel  perwt18f cancerdx cabladdr totexp18 totslf18;
423  %let kept_vars_2019 =  dupersid panel  perwt19f cancerdx cabladdr totexp19 totslf19;
424  %let kept_vars_2020 =  dupersid panel  perwt20f cancerdx cabladdr totexp20 totslf20;
425  
426  /************************************************************************************************
427  concatenate 2018, 2019 and 2020 full year consolidated files
428  use keep= and rename= data set options on the set statement for effeciency
429  *************************************************************************************************/
430  data meps_181920;
431   set new.h209v9 (keep= &kept_vars_2018
432                   rename=(totexp18=totexp
433                           totslf18=totslf) in=a)
434       new.h216 (keep= &kept_vars_2019
435                   rename=(totexp19=totexp
436                           totslf19=totslf) in=b)
437       new.h224 (keep= &kept_vars_2020
438                   rename=(totexp20=totexp
439                           totslf20=totslf) in=c);
440  
441    /* create new variable (year) for data-checks */
442        if a =1 then year=2018;
443        else if b=1 then year=2019;
444        else if c=1 then year=2020;
445  
446    /* create a new weight variable by dividing the original weight by 3 for the pooled data set */
447        if year = 2018 then perwtf = perwt18f/3;
448        else if year = 2019 then perwtf = perwt19f/3;
449        else if year = 2020 then perwtf = perwt20f/3;
450  
451      /* create a new variable: bladder_cancer */
452          if cabladdr = 1 then bladder_cancer = 1;
453          else if cabladdr = 2 | cancerdx = 2 then bladder_cancer = 0;
454          else if cabladdr < 0 then bladder_cancer = .;
455  
456       label totexp = 'total health care expenses 2018-2020'
457           totslf='amount paid by self/family 2018-2020';
458   run;

NOTE: There were 30461 observations read from the data set NEW.H209V9.
NOTE: There were 28512 observations read from the data set NEW.H216.
NOTE: There were 27805 observations read from the data set NEW.H224.
NOTE: The data set WORK.MEPS_181920 has 86778 observations and 12 variables.
NOTE: DATA statement used (Total process time):
      real time           0.26 seconds
      cpu time            0.26 seconds
      

459  
460  /* sort the pooled 2018-2020 meps file by dupersid before merging with the PLVE file */
461  
462  proc sort data=meps_181920;
463    by dupersid panel;
464  run;

NOTE: There were 86778 observations read from the data set WORK.MEPS_181920.
NOTE: The data set WORK.MEPS_181920 has 86778 observations and 12 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.01 seconds
      cpu time            0.01 seconds
      

465  /***********************************************************************
466  - change the 8-character dupersid to 10-character dupersid
467  by adding the panel number to DUPERSIDs of panel 22 year 2017
468  and panels 1-21 in the PLVE file
469  - there is no year variable in the PLVE file
470  - implement this change by using the LENGTH and STRIP functions as folows
471  *************************************************************************/
472  
473    data vsfile ;
474      length dupersid $10;
475      set new.h36u20 (rename=(dupersid=t_dupersid));
476          if length(strip(t_dupersid))=8 then
477            dupersid=cats(put(panel,z2.), t_dupersid);
478          else dupersid = t_dupersid;
479    drop t_dupersid;
480  run;

NOTE: There were 442093 observations read from the data set NEW.H36U20.
NOTE: The data set WORK.VSFILE has 442093 observations and 31 variables.
NOTE: DATA statement used (Total process time):
      real time           0.17 seconds
      cpu time            0.14 seconds
      

481  
482  /* sort the PLVE file for panels 22-25 by dupersid before match-merging ...*/
483  proc sort data= vsfile (where = (panel in (22,23,24,25))) nodupkey
484     out=sorted_vsfile ;
485   by dupersid panel;
486   run;

NOTE: There were 69591 observations read from the data set WORK.VSFILE.
      WHERE panel in (22, 23, 24, 25);
NOTE: 14630 observations with duplicate key values were deleted.
NOTE: The data set WORK.SORTED_VSFILE has 54961 observations and 31 variables.
NOTE: PROCEDURE SORT used (Total process time):
      real time           0.04 seconds
      cpu time            0.04 seconds
      

487  
488  
489  /* merge the pooled 2018-2020 meps data file with the PLVE file for panels 22-25 */
490  
491  data meps_181920_m;
492   merge meps_181920 (in=a) sorted_vsfile ;
493     by dupersid panel;
494   if a;
495  run;

NOTE: There were 86778 observations read from the data set WORK.MEPS_181920.
NOTE: There were 54961 observations read from the data set WORK.SORTED_VSFILE.
NOTE: The data set WORK.MEPS_181920_M has 86778 observations and 41 variables.
NOTE: DATA statement used (Total process time):
      real time           0.03 seconds
      cpu time            0.03 seconds
      

496  
497  ods graphics off;
498  title 'meps pooled files, 2018-2020';
499  title2 'proportion of persons diagnosed with bladder cancer';
500  proc surveymeans data=meps_181920_m  nobs mean stderr sum;
501      var bladder_cancer;
502      stratum stra9620;
503      cluster psu9620;
504      weight perwtf;
505  run;

NOTE: Due to nonpositive weights, 2868 observation(s) were deleted.
NOTE: PROCEDURE SURVEYMEANS used (Total process time):
      real time           0.03 seconds
      cpu time            0.03 seconds
      

506  ods select summary domain;
507  title2 'average expenditures and amount paid by self/family per person';
508  proc surveymeans data=meps_181920_m  nobs mean stderr sum;
509      var totexp totslf;
510      stratum stra9620;
511      cluster psu9620;
512      weight perwtf;
513      domain bladder_cancer;
514  run;

NOTE: Due to nonpositive weights, 2868 observation(s) were deleted.
NOTE: Only one cluster in a stratum for bladder_cancer domains for variable(s) totexp, totslf. The estimate of variance for totexp, 
      totslf will omit this stratum.
NOTE: PROCEDURE SURVEYMEANS used (Total process time):
      real time           0.06 seconds
      cpu time            0.06 seconds
      

515  ods select all; /* clear the SELECT lists for all destinations*/
516  title;  /* cancel the TITLE and TITLE2 statements */
517  
518  
519  /* uncomment the next 2 lines of code to close the proc printto if used earlier */
520  
521  proc printto;
522  run;

